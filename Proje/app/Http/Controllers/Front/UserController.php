<?phpnamespace App\Http\Controllers\front;use Illuminate\Http\Request;use App\Http\Controllers\Controller;use Illuminate\Support\Facades\Auth;use Illuminate\Support\Facades\DB;class UserController extends Controller{    public function __construct()    {        $this->middleware('user');    }    public function index()    {        $data=DB::select('SELECT * FROM settings');        $menu="uye";        return view('front.user_panel',compact('data','menu'));    }    public function sepete_ekle(Request $request)    {        DB::table('sepet')->insert(            [   'urun_id' =>$request->urunid,                'user_id' =>Auth::user()->id,                'miktar' => $request->get('miktar'),                ]);            $id=  $request->get('urunid');            return redirect("/urun/$id")->with('success', 'Urunler Sepete Eklendi..');    }    public function sepetim()    {        $data=DB::select('SELECT * FROM settings');        $veriler=DB::select('SELECT u.* , s.miktar as miktar,s.urun_id as urun_id              FROM urunlers u , sepet s              WHERE u.id=s.urun_id  AND s.user_id=?',[Auth::user()->id]);        $menu="sepet";        return view('front.sepetim',compact('veriler','data','menu'));    }    public function sepet_sil($id)    {        DB::select('DELETE FROM sepet WHERE urun_id=?',[$id]);        return redirect('/sepetim')->with('success','Urun Sepetten Silindi..' );    }    public function siparis_tamamla(Request $request)    {        if ($request->isMethod('post')){        $data=DB::select('SELECT * FROM settings');        $user=DB::select('SELECT * FROM users WHERE id=?',[Auth::user()->id]);        $toplam=$request->get('toplam');        $menu="sepet";        return view('front.siparis_tamamla',compact('veriler','data','menu','user','toplam'));        }else{            echo "Hata: Post Bilgisi Yok";        }    }    public function satinal(Request $request)    {        $onay=1;        //Kredi kart bilgilerini al        //Bankaya gonder onay gelirse islem yap        if ($onay==1) {            DB::table('siparis')->insert(                ['adsoy' => $request->get('adsoy'),                    'user_id' => Auth::user()->id,                    'tutar' => $request->get('toplam'),                    'adres' => $request->get('adres'),                    'sehir' => $request->get('sehir'),                    'tel' => $request->get('tel')                ]);            $siparisid= DB::getPdo()->lastInsertId();            $veriler=DB::select('select u.*,s.miktar as miktar                                       from urunlers u,sepet s                                       where u.id=s.urun_id and s.user_id=?',[Auth::user()->id]);            foreach ($veriler as $rs){                DB::table('siparis_detay')->insert(                    ['siparis_id' =>$siparisid,                        'user_id' => Auth::user()->id,                        'urun_id' => $rs->id,                        'fiyat' => $rs->sfiyat,                        'miktar' => $rs->miktar,                        'adi' => $rs->adi,                        'tutar' => $rs->miktar*$rs->sfiyat                    ]);            }            DB::select('DELETE FROM sepet WHERE user_id=?',[Auth::user()->id]);            return redirect('/siparis_son')->with('success','Alisveris Isleminiz Basariyla Tamamlanmistir.' );        }        else{            echo "Bankadan Onay Alinamamistir...";        }    }    public function siparis_son(){        $data=DB::select('SELECT * FROM settings');        $menu="user";        return view('front.siparis_son',compact('menu','data'));    }    public function siparisler(){        $data=DB::select('SELECT * FROM settings');        $data2=DB::select('SELECT * FROM siparis WHERE user_id=?',[Auth::user()->id]);        $menu="user";        return view('front.siparisler',compact('menu','data','data2'));    }    public function siparis_detay($id){        $data=DB::select('SELECT * FROM settings');        $siparis=DB::select('SELECT * FROM siparis WHERE id=?',[$id]);        $urunler=DB::select("select s.*,u.resim as resim                                    FROM siparis_detay s,urunlers u                                    WHERE s.urun_id=u.id AND s.siparis_id=?",[$id]);        $menu="user";        return view('front.siparis_urunler',compact('menu','siparis','urunler','data'));    }}